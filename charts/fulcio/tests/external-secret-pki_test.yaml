suite: Fulcio PKI External Secret
templates:
  - external-secret-pki.yaml

tests:
  - it: should create Fulcio PKI ExternalSecret in vault mode
    set:
      global.pki.mode: vault
      global.secrets.vault.env: demo
      global.secrets.vault.project: testifysec-judge
    asserts:
      - isKind:
          of: ExternalSecret
      - equal:
          path: spec.secretStoreRef.name
          value: vault-fulcio
      - equal:
          path: spec.data[0].secretKey
          value: cert
      - equal:
          path: spec.data[1].secretKey
          value: private
      - equal:
          path: spec.data[2].secretKey
          value: password

  - it: should not create ExternalSecret in dev mode
    set:
      global.pki.mode: dev
    asserts:
      - hasDocuments:
          count: 0
